import e from"jquery";function t(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){i(e,t,a[t])})}return e}function n(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},l=Object.keys(e);for(a=0;a<l.length;a++)i=l[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)i=l[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var l=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(~t){var i=e.children();if(i&&i.length)return i.eq(t)}}},s=function(e){return function(t){if(~t){var i=e.children();if(i&&i.length&&t<i.length)return i.slice(t).hide()}}},r=e.noop,o=e.when,c=e.extend,d=e.isArray,h=e.isFunction,u=e.isEmptyObject,v={placeholder:"请选择",ele:".J_Cascader",head:".J_CascaderHead",body:".J_CascaderBody",input:".J_CascaderVal",panelHead:".J_PanelHead",panelBody:".J_PanelBody",panelTpl:'<div class="cascader-panel-item"></div>',panelItemTpl:'<a href="javascript:void(0);" title=""></a>',animation:!0,apiMethod:null,onChange:r,onComplete:r},p=function(){function i(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var a=c({},v,t),n=a.ele,r=a.input,o=a.value,d=a.panelHead,h=a.panelBody,u=e(n),p=u.find(d),f=u.find(h);this.getPrevHead=l(p),this.getPrevBody=l(f),this.checkSurPlusHead=s(p),this.checkSurPlusBody=s(f),this.options=a,this.$doc=e(document),this.$ele=u,this.$head=p,this.$body=f,this.$input=u.find(r),this.activeItem=null,this.activeItems=[],this._initialized=!1,this._bindEvents(),this._loadData(o)}var r,p,f;return r=i,(p=[{key:"_loadData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!isNaN(+t)){var a=this.options.apiMethod;o(a&&a(t,i)).done(function(t){t&&t.length?e._renderPanel(t,i):e.complete()}).fail(console.error)}}},{key:"_bindEvents",value:function(){var e=this.options,t=e.head,i=e.body,a=e.animation,n=this.$ele,l=this.$doc,s=n.find(t),r=n.find(i),o=s.find(".icon");s.click(function(){n.toggleClass("opened"),o.toggleClass("icon-arrow-up"),a?r.slideToggle("fast"):r.show(),l.on("click.toggle.CascaderBody",function(e){var t=e.target;n.is(t)||n.has(t).length||(l.off("click.toggle.CascaderBody"),n.toggleClass("opened"),o.toggleClass("icon-arrow-up"),a?r.slideUp():r.hide())})})}},{key:"_renderPanel",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this,o=this.options,c=o.panelTpl,v=o.panelItemTpl,p=o.onChange,f=o.placeholder,g=this.$head,b=this.$body,m=this.getPrevHead,y=this.getPrevBody,C=this.checkSurPlusHead,I=this.checkSurPlusBody,w=m(i),P=w&&w.length,_=P?w:e(v),k=y(i),O=k&&k.length,x=O?k:e(c);O&&(I(i),b.children().eq(i).show().siblings().hide(),x.children().show().removeClass("active"),d(t)&&s(x)(t.length));var j=l(x),$=null,B=null;if(d(t)&&t.length)for(var T=function(l,s){var o=t[l],c=o.label,d=o.value,u=o.type,f=o.parentId,g=o.active,b=o.disabled,m=o.children,y=n(o,["label","value","type","parentId","active","disabled","children"]),C=a({label:c,value:d,parentId:f},y),I=j(l),w=I&&I.length,P=w?I:e(v);P.text(c).attr("title",c).addClass(function(){return g&&"active"}).addClass(function(){return b&&"disabled"}),w?P.off():x.append(P),g&&(B=C,r.activeItem=C,r.activeItems[i]=C),m&&m.length&&($=m),!b&&P.click(function(){if(e(this).addClass("active").siblings().removeClass("active"),i=_.text(c).attr("title",c).data("value",d).index(),r.activeItem=C,r.activeItems=r.activeItems.slice(0,i+1),r.activeItems[i]=C,h(p)&&p(r.activeItem,r.activeItems,r),d)return r._loadData(d,u)})},H=0,S=t.length;H<S;H++)T(H);B&&!u(B)?_.text(B.label).attr("title",B.label):_.text(f).attr("title",f),P?(C(i),g.off()):g.append(_),_.click(function(){var t=e(this).index();e(this).addClass("active").siblings().removeClass(),b.children().eq(t).show().addClass("active").siblings().hide().removeClass("active")}),!O&&b.append(x),$&&$.length?r._renderPanel($,++i):B&&B.hasChildren&&B.value?r._loadData(B.value,++i):O?(_.addClass("active").siblings().removeClass(),_.show().prevAll().show(),_.nextAll().hide(),b.children().eq(i).show().addClass("active").nextAll().hide().removeClass("active")):(_.addClass("active").siblings().removeClass(),b.children().eq(i).show().addClass("active").siblings().hide().removeClass("active")),!this._initialized&&this._updateInput()}},{key:"getLabelText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ",i=arguments.length>1?arguments[1]:void 0,a=this.$head,n=this.options.placeholder,l=[];return a.children().each(function(){var t=e(this),i=t.text().trim();"none"!==t.css("display")&&i!==n&&l.push(i)}),i?l:l.join(t)}},{key:"complete",value:function(e){!e&&this.$doc.click(),this._updateInput();var t=this.options.onComplete;h(t)&&t(this.activeItem,this.activeItems,this)}},{key:"_updateInput",value:function(){var e=this.$input,t=(this.activeItem||{}).value,i=this.options.placeholder,a=this.getLabelText()||i;"INPUT"===e.prop("tagName")?e.val(a).data("value",t).attr("value",t):e.text(a).data("value",t),this._initialized=!0}}])&&t(r.prototype,p),f&&t(r,f),i}();e.fn.initCascader=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.each(function(){return new p(h(e)?a({},e,{onComplete:e,ele:this}):a({},e,{ele:this}))})};export default p;
